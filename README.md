# Анализатор IT-вакансий

Это веб-приложение для анализа IT-вакансий, которое позволяет получать аналитические данные о рынке труда в IT-сфере. Приложение собирает данные о вакансиях, применяет различные фильтры и создает интерактивные визуализации.

## Содержание

- [Архитектура приложения](#архитектура-приложения)
- [API-клиент](#api-клиент)
- [Фильтрация данных](#фильтрация-данных)
- [Визуализация данных](#визуализация-данных)
- [Экспорт данных](#экспорт-данных)
- [Зависимости](#зависимости)

## Архитектура приложения

Приложение построено на основе Flask и использует модульную структуру:

```
/app
  /__init__.py      # Инициализация приложения
  /api/             # API-клиент и маршруты
    /routes.py      # Маршруты Flask
    /utils.py       # Утилиты для работы с API
    /geo.py         # Геоданные и их обработка
  /services/        # Сервисы для обработки данных
    /visualization.py  # Создание визуализаций
/static/           # Статические файлы (CSS, JS)
/templates/        # Шаблоны HTML
  /base.html       # Базовый шаблон
  /index.html      # Страница с формой поиска
  /analysis.html   # Страница с результатами анализа
/logs/             # Логи работы приложения
/run.py            # Точка входа в приложение
```

## API-клиент

### Основные компоненты

API-клиент реализован в модуле `app.api.utils` и предоставляет следующие возможности:

#### Функции для работы с API

1. **`load_vacancies_with_filters(filters)`** - Основная функция загрузки вакансий с применением фильтров
   - Принимает словарь фильтров и преобразует их в параметры запроса
   - Выполняет разбиение запросов на страницы (пагинацию) для обработки большого количества данных
   - Выполняет кэширование результатов для оптимизации производительности

2. **`extract_filter_data(form_data)`** - Извлекает данные фильтров из формы
   - Обрабатывает текстовый запрос, выбранные регионы, диапазон зарплат и другие параметры
   - Преобразует данные в формат, удобный для использования в запросах к API

3. **`generate_filter_query(filters)`** - Генерирует параметры запроса для API
   - Формирует параметры запроса на основе фильтров
   - Учитывает особенности API и требований к формату запроса

4. **`load_area_tree()`** и **`get_area_name(area_id)`** - Работа с географическими данными
   - Загружает дерево регионов и городов для фильтрации
   - Преобразует идентификаторы регионов в названия

### Маршруты приложения

В модуле `app.api.routes` реализованы следующие маршруты:

1. **`@api_bp.route('/')`** - Главная страница с формой поиска
   - Отображает форму для ввода параметров анализа

2. **`@api_bp.route('/analyze', methods=['POST'])`** - Выполнение анализа
   - Обрабатывает параметры из формы
   - Загружает вакансии с применением фильтров
   - Генерирует визуализации и аналитические данные
   - Отображает результаты анализа

3. **`@api_bp.route('/export/<export_type>', methods=['POST'])`** - Экспорт данных
   - Экспортирует аналитические данные в различных форматах (CSV, Excel, PDF)
   - Создает структурированные отчеты с разделами для разных типов аналитики

4. **`@api_bp.route('/clear_cache', methods=['POST'])`** - Очистка кэша
   - Очищает временные данные при покидании страницы

## Фильтрация данных

### Механизм фильтрации

Процесс фильтрации вакансий реализован в несколько этапов:

1. **Извлечение параметров из формы**
   - Обработка текстового запроса (текст ищется в названии, описании и требованиях вакансии)
   - Обработка выбранных регионов/городов
   - Обработка диапазона зарплат и выбранной валюты
   - Дополнительные фильтры (опыт работы, график, тип занятости)

2. **Формирование запроса к API**
   - Преобразование параметров в формат API
   - Создание строки запроса

3. **Fallback-логика**
   - Если по выбранным городам ничего не найдено, пробуем поиск по их областям
   - Если и это не дает результатов, выполняем поиск по всей стране

4. **Фильтрация IT-вакансий**
   - Дополнительная фильтрация результатов для выделения IT-вакансий по ключевым словам в названии, описании и навыках
   - Список ключевых слов включает различные IT-технологии, языки программирования и должности

### Функция `get_vacancies_with_fallback(filters)`

Эта функция реализует трехступенчатую стратегию поиска:

1. Сначала пытается найти вакансии по выбранным городам/регионам
2. Если ничего не найдено, пробует искать по родительским регионам
3. Если и это не помогает, расширяет поиск на всю страну

## Визуализация данных

### Модуль визуализации

Визуализация данных реализована в модуле `app.services.visualization` и содержит следующие основные функции:

1. **`generate_all_visualizations(vacancies, filters)`** - Создает все визуализации
   - Принимает список вакансий и примененные фильтры
   - Координирует создание различных типов визуализаций
   - Возвращает словарь с HTML-кодом визуализаций и сводку данных

2. **Блоки визуализаций** (все реализованы как отдельные функции):
   - **`generate_general_block`** - Общая характеристика вакансий (количество, публикации по датам, распределение по регионам)
   - **`generate_salary_block`** - Анализ зарплат (статистика, распределение по опыту, регионам)
   - **`generate_experience_block`** - Анализ по опыту работы, типу занятости и графику
   - **`generate_skills_block`** - Анализ ключевых навыков (топ навыков, облако слов)
   - **`generate_employers_block`** - Анализ работодателей (топ по количеству вакансий, зарплаты)

### Типы визуализаций

В приложении используются следующие типы визуализаций:

1. **Интерактивная карта вакансий**
   - Географическое распределение вакансий с кластеризацией
   - При клике показывает детали вакансии

2. **Графики зарплат**
   - Гистограмма распределения зарплат
   - Сравнение минимальной, максимальной, средней и медианной зарплаты
   - Зарплаты по опыту работы (медианная и средняя)
   - Зарплаты по регионам

3. **Графики распределения вакансий**
   - По опыту работы (круговая диаграмма и горизонтальная гистограмма)
   - По графику работы (круговая диаграмма)
   - По типу занятости (гистограмма)
   - По регионам (круговая диаграмма)

4. **Визуализация навыков**
   - Топ-20 востребованных навыков (горизонтальная гистограмма)
   - Облако слов для навыков

5. **Анализ работодателей**
   - Топ работодателей по количеству вакансий
   - Средние зарплаты по работодателям

## Экспорт данных

### Форматы экспорта

Приложение поддерживает экспорт аналитических данных в трех форматах:

1. **CSV** - Простой текстовый формат с разделителями
   - Все аналитические данные объединяются в одну таблицу с разделами
   - Каждый раздел имеет заголовок и разделитель

2. **Excel** - Таблицы Microsoft Excel
   - Каждый тип данных размещается на отдельном листе
   - Применяется форматирование для улучшения читаемости
   - Заголовки выделяются цветом

3. **PDF** - Документ в формате PDF
   - Титульная страница с общей информацией
   - Отдельные страницы для каждого типа аналитических данных
   - Форматированные таблицы с данными

### Структура экспортируемых данных

Экспортируемые данные включают следующие разделы:

1. **Общая информация**
   - Параметры поиска (текстовый запрос, регион)
   - Дата запроса
   - Количество найденных вакансий

2. **Статистика зарплат**
   - Минимальная, максимальная, средняя и медианная зарплата

3. **Распределение по опыту**
   - Количество вакансий для каждой категории опыта

4. **Распределение по регионам**
   - Количество вакансий в каждом регионе

5. **Топ навыков**
   - Наиболее востребованные навыки с количеством упоминаний

6. **Список вакансий**
   - Таблица с основной информацией о вакансиях (название, компания, зарплата и т.д.)

## Зависимости

Проект использует следующие основные зависимости:

1. **Веб-фреймворк**
   - Flask - Основной фреймворк
   - Flask-CORS - Поддержка кросс-доменных запросов

2. **Обработка данных**
   - Pandas - Анализ и манипуляция данными
   - NumPy - Математические операции

3. **Визуализация**
   - Plotly - Создание интерактивных визуализаций
   - WordCloud - Создание облака слов

4. **Экспорт данных**
   - openpyxl - Работа с Excel файлами
   - matplotlib - Создание PDF-отчетов

5. **Работа с валютами**
   - CurrencyConverter - Конвертация валют

## Установка и запуск

1. Клонировать репозиторий
2. Установить зависимости: `pip install -r requirements.txt`
3. Запустить приложение: `python run.py`
4. Открыть в браузере: `http://localhost:5000`

## Лицензия

Проект распространяется под лицензией MIT.
